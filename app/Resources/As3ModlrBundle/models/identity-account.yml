identity-account:
    entity:
        persistence:
            key: mongodb
            db: radix
            schemata:
                -
                    keys:
                        "credentials.password.username": 1
                    options:
                        unique: true
                        partialFilterExpression:
                            "credentials.password.username":
                                "$exists": true
                -
                    keys:
                        "credentials.social.identifier": 1
                    options:
                        unique: true
                        partialFilterExpression:
                            "credentials.social.identifier":
                                "$exists": true
                -
                    keys:
                        "credentials.password.resetCode": 1
                    options:
                        unique: true
                        partialFilterExpression:
                            "credentials.password.resetCode":
                                "$exists": true

    mixins: [ 'identity-attributable', 'timestampable' ]
    attributes:
        primaryEmail:
            type: string
            description: 'The primary email address of this account.'
            calculated:
                class: AppBundle\CalculatedFields
                method: identityAccountPrimaryEmail
        displayName:
            type: string # should have an intelligent default if empty: try the first part of an email address, try a password username value, try a social nickname, etc.
        picture:
            type: string
        roles:
            type: array
            defaultValue: [ USER ]
    embeds:
        credentials:
            type: one
            entity: identity-account-credentials
            description: 'The credentials this account owns. Used for signing in.'
        settings:
            type: one
            entity: identity-account-settings
        history:
            type: one
            entity: identity-account-history
    relationships:
        emails:
            type: many
            inverse: true
            field: account
            entity: identity-account-email
            description: 'The email addresses that this account owns.'

